<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Todo List</title>

    <!-- Bootstrap v5.3 -->
    <link
      rel="stylesheet"
      href="assets/vendor/bootstrap-5.3.7/package/dist/css/bootstrap.min.css"
    />
    <!-- Bootstrap Icons -->
    <link
      rel="stylesheet"
      href="assets/vendor/bootstrap-icons-1.13.1/package/font/bootstrap-icons.min.css"
    />
    <!-- SortableJS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Sortable/1.15.2/Sortable.min.js"></script>
  </head>
  <body>
    <div class="container mt-5">
      <h1>Todo List</h1>
      <hr />

      <!-- Form -->
      <form id="formData" class="mb-3">
        <div class="input-group">
          <input type="text" class="form-control" name="todo" />
          <button type="submit" class="btn btn-primary">
            <i class="bi bi-plus"></i> Tambah
          </button>
        </div>
      </form>

      <!-- Filter & Search -->
      <div class="d-flex mb-3">
        <select id="filter" class="form-select me-2" style="max-width: 200px">
          <option value="all">Semua</option>
          <option value="completed">Selesai</option>
          <option value="pending">Belum Selesai</option>
        </select>
        <input
          type="text"
          id="search"
          class="form-control"
          placeholder="Cari todo..."
        />
      </div>

      <!-- Todo List -->
      <ul class="list-group" id="todoList"></ul>
    </div>

    <script>
      let todos = [];

      function saveTodos() {
        localStorage.setItem("todos", JSON.stringify(todos));
      }

      function renderTodos() {
        const todoList = document.getElementById("todoList");
        const filter = document.getElementById("filter").value;
        const search = document.getElementById("search").value.toLowerCase();

        todoList.innerHTML = "";

        todos.forEach((item, index) => {
          // Filter
          if (filter === "completed" && !item.completed) return;
          if (filter === "pending" && item.completed) return;
          // Search
          if (!item.todo.toLowerCase().includes(search)) return;

          const li = document.createElement("li");
          li.className =
            "list-group-item d-flex justify-content-between align-items-center";
          li.dataset.index = index;

          const leftDiv = document.createElement("div");
          leftDiv.className = "flex-fill";

          const checkbox = document.createElement("input");
          checkbox.type = "checkbox";
          checkbox.className = "form-check-input me-2";
          checkbox.checked = item.completed;
          checkbox.addEventListener("change", () => {
            item.completed = checkbox.checked;
            saveTodos();
            renderTodos();
          });

          const label = document.createElement("span");
          label.textContent = item.todo;
          label.style.textDecoration = item.completed
            ? "line-through"
            : "none";

          leftDiv.appendChild(checkbox);
          leftDiv.appendChild(label);

          // Tombol Edit & Hapus
          const btnGroup = document.createElement("div");

          const editBtn = document.createElement("button");
          editBtn.className = "btn btn-sm btn-outline-secondary me-2";
          editBtn.innerHTML = '<i class="bi bi-pencil"></i>';
          editBtn.addEventListener("click", () => {
            const newTodo = prompt("Edit todo:", item.todo);
            if (newTodo && newTodo.trim() !== "") {
              // Validasi duplikat
              if (
                todos.some(
                  (t, i) =>
                    t.todo.toLowerCase() === newTodo.toLowerCase() &&
                    i !== index
                )
              ) {
                alert("Todo sudah ada!");
                return;
              }
              item.todo = newTodo.trim();
              saveTodos();
              renderTodos();
            }
          });

          const deleteBtn = document.createElement("button");
          deleteBtn.className = "btn btn-sm btn-outline-danger";
          deleteBtn.innerHTML = '<i class="bi bi-trash"></i>';
          deleteBtn.addEventListener("click", () => {
            todos.splice(index, 1);
            saveTodos();
            renderTodos();
          });

          btnGroup.appendChild(editBtn);
          btnGroup.appendChild(deleteBtn);

          li.appendChild(leftDiv);
          li.appendChild(btnGroup);
          todoList.appendChild(li);
        });

        // Aktifkan sortableJS
        new Sortable(todoList, {
          animation: 150,
          onEnd: (evt) => {
            const moved = todos.splice(evt.oldIndex, 1)[0];
            todos.splice(evt.newIndex, 0, moved);
            saveTodos();
          },
        });
      }

      document.addEventListener("DOMContentLoaded", function () {
        const form = document.getElementById("formData");

        // Load from storage
        const storedTodos = localStorage.getItem("todos");
        if (storedTodos) {
          todos = JSON.parse(storedTodos);
        }

        form.addEventListener("submit", function (event) {
          event.preventDefault();
          const todoInput = form.todo.value.trim();

          if (todoInput === "") {
            alert("Todo tidak boleh kosong!");
            return;
          }

          // Validasi duplikat
          if (
            todos.some((item) => item.todo.toLowerCase() === todoInput.toLowerCase())
          ) {
            alert("Todo sudah ada!");
            return;
          }

          todos.unshift({
            todo: todoInput,
            completed: false,
          });

          form.todo.value = "";
          saveTodos();
          renderTodos();
        });

        document.getElementById("filter").addEventListener("change", renderTodos);
        document.getElementById("search").addEventListener("input", renderTodos);

        renderTodos();
      });
    </script>
  </body>
</html>
